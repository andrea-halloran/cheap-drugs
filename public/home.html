<!DOCTYPE html> <!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="assets/drug-icon.png" />
    <title>Cheap Drugs</title>

    <!-- CSS -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Bungee"
      rel="stylesheet"
    />

    <link
      href="css/materialize.css"
      type="text/css"
      rel="stylesheet"
      media="screen,projection"
    />
    <link
      href="css/style.css"
      type="text/css"
      rel="stylesheet"
      media="screen,projection"
    />

    <link
      href="css/results.css"
      type="text/css"
      rel="stylesheet"
      media="screen,projection"
    />

    <link
      href="css/scroller.css"
      type="text/css"
      rel="stylesheet"
      media="screen,projection"
    />

    <link
      href="//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.1/normalize.min.css"
      rel="stylesheet"
      data-semver="3.0.1"
      data-require="normalize@*"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script
      src="https://code.jquery.com/jquery-3.3.1.js"
      integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
      crossorigin="anonymous"
    ></script>

    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script src="js/homepage.js"></script>
    <script src="js/results.js"></script>
    <!-- <script src="js/news.js"></script> -->
    <style>

      .legend {
        font-size: 12px;
      }
      rect {
        stroke-width: 2;
      }
      #chart {
        height: 360px;
        position: relative;
        width: 360px;
        margin-left: auto;
        margin-right: auto;
      }
      .tooltip {
        background: #eee;
        box-shadow: 0 0 5px #999999;
        color: #333;
        display: none;
        font-size: 12px;
        left: 130px;
        padding: 10px;
        position: absolute;
        text-align: center;
        top: 95px;
        width: 80px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <ul id="dropdown1" class="dropdown-content">
      <li><a href="profile.html">My Profile</a></li>
      <li><a href="aboutus.html">About Us</a></li>
    </ul>

    <nav>
      <div class="nav-wrapper indigo darken-4">
        <a href="home.html">
          <img
            src="assets/drug-icon.png"
            alt="Nav Bar Icon"
            width="40px"
            height="40px"
            id="drugIcon"
            style="padding:0px; margin:12px"
        /></a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li>
            <a href="login.html" class="white-text"
              ><i class="material-icons">account_circle</i></a
            >
          </li>
          <li>
              <a href="create_profile.html" class="white-text"
                >Sign Up</a
              >
            </li>
          <li>
            <a
              class="dropdown-trigger white-text"
              href="#!"
              data-target="dropdown1"
              >Options<i class="material-icons right">arrow_drop_down</i></a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Login</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="email-input" class="col-form-label">Email</label>
                            <input type="email" class="form-control" id="email-input">
                        </div>
                        <div class="form-group">
                            <label for="password-input" class="col-form-label">Password</label>
                            <input type="password" class="form-control" id="password-input">
                        </div>
                        <span class="error text-danger"></span>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary login-button">Login</button>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Login Modal -->

    <div class="bannerBorder">
      <div id="index-banner" class="parallax-container">
        <div class="section no-pad-bot">
          <div class="container">
            <br /><br />
            <h1 class="header center indigo-text text-darken-4">Cheap Drugs</h1>
            <div class="row center">
              <h5 class="header col s12 indigo-text text-darken-4">
                A drug cost comparison and pharmacy location app
              </h5>
            </div>
            <br />
            <div class="row">
              <form class="col s12">
                <div class="row">
                  <div class="input-field col s12 white searchEntry">
                    <input id="search" type="text" required />
                    <label for="search">Enter Your Prescription</label>
                  </div>

                  <div class="input-field col s12 white searchEntry">
                    <input id="zip" type="text" required pattern="[0-9]{5}" />
                    <label for="zip">Enter Your Zip Code</label>
                  </div>

                  <div class="input-field col s12">
                    <button
                      id="searchBtn"
                      class="btn waves-effect waves-light"
                      type="button"
                      name="action"
                    >
                      Submit
                    </button>
                  </div>
                </div>
              </form>
            </div>
            <br />
          </div>
        </div>
        <div class="parallax">
          <img
            src="assets/pills.jpg"
            alt="Unsplashed background img 1"
            id="pillBackground"
          />
        </div>
      </div>
    </div>

    <div class="container">
      <h2 id="prescription-name"></h2>
      <h3 id="manufacturer-name"></h3>
      <h4 id="generic-name"></h4>
      <p id="description"></p>
      <p id="warnings"></p>
      <p id="route"></p>
    </div>

    <div id="chart"></div>

    <!-- News Scroller -->
    <div class="container">
      <div class="section">
        <!-- Icon Section -->
        <div class="row">
          <div class="icon-block">
            <h2 class="center brown-text">
              <i class="material-icons">rss_feed</i>
            </h2>
            <h5 class="center">Information Feed</h5>
            <!-- list -->
            <!--
              <div class="holder article-section" id="article-section">
                <ul class="empty-list"></ul>
              </div>
            -->
            <div class="wrapper">
              <!-- Main Container -->

              <div class="box">
                <!-- Div that will hold the UL -->
                <div class="scroll"><ol class="empty-list"></ol></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End of Scroller -->

    <div class="container">
      <div id="results"></div>

      <div class="section">
        <!-- Icon Section -->
        <div class="row">
          <div class="col s12 m4">
            <div class="icon-block">
              <h2 class="center brown-text">
                <i class="material-icons">rss_feed</i>
              </h2>
              <h5 class="center">Information Feed</h5>

              <p class="light">
                We did most of the heavy lifting for you to provide a default
                stylings that incorporate our custom components. Additionally,
                we refined animations and transitions to provide a smoother
                experience for developers.
              </p>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="icon-block">
              <h2 class="center brown-text">
                <i class="material-icons">group</i>
              </h2>
              <h5 class="center">User Experience Focused</h5>

              <p class="light">
                By utilizing elements and principles of Material Design, we were
                able to create a framework that incorporates components and
                animations that provide more feedback to users. Additionally, a
                single underlying responsive system across all platforms allow
                for a more unified user experience.
              </p>
            </div>
          </div>

          <div class="col s12 m4">
            <div class="icon-block">
              <h2 class="center brown-text">
                <i class="material-icons">map</i>
              </h2>
              <h5 class="center">Heat Map</h5>

              <p class="light">
                We have provided detailed documentation as well as specific code
                examples to help new users get started. We are also always open
                to feedback and can answer any questions a user may have about
                Materialize.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Map -->

    <input
      id="pac-input"
      class="controls"
      type="text"
      placeholder="Search Box"
    />
    <div id="map"></div>
    <!-- Replace the value of the key parameter with your own API key. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUhV07kpgoZqyw6HBr3lZ7jKp23AAgV-g
            &libraries=places&callback=initAutocomplete"
      async
      defer
    ></script>

    <!-- End of Map -->

    <footer class="page-footer teal">
      <div class="container">
        <div class="row">
          <div class="col l4 s12">
            <h5 class="white-text">Motivation</h5>
            <p class="grey-text text-lighten-4" id="motivation">
              <strong>Cheap Drugs</strong> serves as a hub for prescription
              information that is friendly to all users. The tools this site
              provides empowers the consumer to find pharmacies, affordable
              pricing, and relevant pharmaceutical news.
            </p>
          </div>
          <div class="col l4 s12">
            <h5 class="white-text">Features</h5>
            <ul>
              <li>Search for Prescription Drug Info</li>
              <li>Compare Costs Internationally</li>
              <li>Find Low Prices (FamilyWize)</li>
              <li>Breaking News on Prescriptions</li>
            </ul>
          </div>
          <div class="col l4 s12">
            <h5 class="white-text">Future Updates</h5>
            <ul>
              <li>Email Notifications</li>
              <li>Checking for Prescription Interactions</li>
              <li>Discounts and Coupons</li>
              <li>User Search History</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="container">
          Made for the
          <a
            class="brown-text text-lighten-3"
            href="https://techbootcamps.utexas.edu/coding/"
            >University of Texas Coding Bootcamp</a
          >
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="js/materialize.js"></script>
    <script src="js/init.js"></script>
    <script src="js/homepage.js"></script>
    <!-- <script src="js/news.js"></script> -->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
      $("#searchBtn").on("click", function(event) {
        console.log("Submit was clicked");
        var prescription = $("#search")
          .val()
          .trim();
        var newSearch =
          $("#search")
            .val()
            .trim() +
          "&" +
          $("#zip")
            .val()
            .trim();

        console.log(newSearch);

        var pName = document.getElementById("prescription-name");
        pName.innerHTML = prescription;

        $.get("/api/drugs/" + newSearch, function(data) {
          var mName = document.getElementById("manufacturer-name");
          var gName = document.getElementById("generic-name");
          var descrip = document.getElementById("description");
          var warns = document.getElementById("warnings");
          var pRoute = document.getElementById("route");

          console.log(data.openFDA.results[0]);

          mNameResult = data.openFDA.results[0].openfda.manufacturer_name;
          gNameResult = data.openFDA.results[0].openfda.generic_name;
          descripResult = data.openFDA.results[0].description;
          warnsResult = data.openFDA.results[0].boxed_warning;
          pRouteResult = data.openFDA.results[0].openfda.route;

          if (descripResult) {
            descrip.innerHTML = descripResult;
          } else {
            descrip.innerHTML = "Description: Not Available";
          }

          if (warnsResult) {
            warns.innerHTML = warnsResult;
          } else {
            warns.innerHTML = "Warnings: Not Available";
          }

          if (gNameResult) {
            gName.innerHTML = gNameResult;
          } else {
            gName.innerHTML = "Generic Name: Not Available";
          }

          if (mNameResult) {
            mName.innerHTML = mNameResult;
          } else {
            mName.innerHTML = "Manufacturer Name: Not Available";
          }

          if (pRouteResult) {
            pRoute.innerHTML = "Route: " + pRouteResult;
          } else {
            pRoute.innerHTML = "Route: Not Available";
          }

          $(".empty-list").empty();

          for (let i = 0; i < 10; i++) {
            $(".empty-list").append(
              "<li><a href=" +
                data.nyt.response.docs[i].web_url +
                ">" +
                data.nyt.response.docs[i].snippet +
                "</a></li>"
            );
          }

          var tooltip = d3
            .select("#chart") // NEW
            .append("div") // NEW
            .attr("class", "tooltip"); // NEW

          tooltip
            .append("div") // NEW
            .attr("class", "label"); // NEW

          tooltip
            .append("div") // NEW
            .attr("class", "count"); // NEW

          tooltip
            .append("div") // NEW
            .attr("class", "percent"); // NEW

          d3.csv("prescription_data2.csv", function(error, data2) {
            if (error) throw error;
            console.log(data2);
            let searchResult = 0;
            for (var i = 0; i < data2.length; i++) {
              if (data2[i].Prescription === prescription) {
                searchResult = i;
              }
            }

            console.log(data2[searchResult]);

            var keys = ["USMedicarePrice", "Norway", "England", "Ontario"];

            var donutData = new Array();

            donutData.push({
              label: "USMedicarePrice",
              count: data2[searchResult].USMedicarePrice
            });
            donutData.push({
              label: "Norway",
              count: data2[searchResult].Norway
            });
            donutData.push({
              label: "England",
              count: data2[searchResult].England
            });
            donutData.push({
              label: "Ontario",
              count: data2[searchResult].Ontario
            });

            console.log(donutData);

            var width = 360;
            var height = 360;
            var radius = Math.min(width, height) / 2;
            var donutWidth = 75;
            var legendRectSize = 18; // NEW
            var legendSpacing = 4; // NEW

            var color = d3.scaleOrdinal(d3.schemeCategory20b);

            var svg = d3
              .select("#chart")
              .append("svg")
              .attr("width", width)
              .attr("height", height)
              .append("g")
              .attr(
                "transform",
                "translate(" + width / 2 + "," + height / 2 + ")"
              );

            var arc = d3
              .arc()
              .innerRadius(radius - donutWidth)
              .outerRadius(radius);

            var pie = d3
              .pie()
              .value(function(d) {
                return d.count;
              })
              .sort(null);

            var path = svg
              .selectAll("path")
              .data(pie(donutData))
              .enter()
              .append("path")
              .attr("d", arc)
              .attr("fill", function(d, i) {
                return color(d.data.label);
              });

            path.on("mouseover", function(d) {
              var total = d3.sum(
                donutData.map(function(d) {
                  return d.count;
                })
              );
              var percent = Math.round((1000 * d.data.count) / total) / 10;
              tooltip.select(".label").html(d.data.label);
              tooltip.select(".count").html("$" + d.data.count);
              tooltip.style("display", "block"); // NEW
            }); // NEW

            path.on("mouseout", function(d) {
              tooltip.style("display", "none"); // NEW
            });

            path.on("mousemove", function(d) {
              tooltip
                .style("top", d3.event.layerY + 10 + "px")
                .style("left", d3.event.layerX + 10 + "px");
            });

            var legend = svg
              .selectAll(".legend") // NEW
              .data(color.domain()) // NEW
              .enter() // NEW
              .append("g") // NEW
              .attr("class", "legend") // NEW
              .attr("transform", function(d, i) {
                // NEW
                var height = legendRectSize + legendSpacing; // NEW
                var offset = (height * color.domain().length) / 2; // NEW
                var horz = -2 * legendRectSize; // NEW
                var vert = i * height - offset; // NEW
                return "translate(" + horz + "," + vert + ")"; // NEW
              }); // NEW

            legend
              .append("rect") // NEW
              .attr("width", legendRectSize) // NEW
              .attr("height", legendRectSize) // NEW
              .style("fill", color) // NEW
              .style("stroke", color); // NEW

            legend
              .append("text") // NEW
              .attr("x", legendRectSize + legendSpacing) // NEW
              .attr("y", legendRectSize - legendSpacing) // NEW
              .text(function(d) {
                return d;
              }); // NEW
          });

          scroller();
        });
      });

      function scroller() {
        var scroll = $("div.scroll"); // Sets the div with a class of scroll as a variable

        var height = scroll.height(); // Gets the height of the scroll div

        var topAdj = -height - 30;
        /* '-height' turns the height                   of the UL into a negative #,
         * '- 50' subtracts an extra 50 pixels from the height of
         * the div so that it moves the trail of the UL higher to
         * the top of the div before the animation                ends
         */

        scroll.animate(
          {
            top: [topAdj, "linear"]
          },
          50000,
          function() {
            scroll.css("top", 250); //resets the top position of the Ul for the next cycle
            scroller(); // Recalls the animation cycle to begin.
          }
        );
      }
    </script>
  </body>
</html>
